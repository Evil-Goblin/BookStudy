## 기본키
- 관계형 모델을 따르려면 데이터베이스 시스템이 한 테이블에 있는 특정 로우와 나머지 로우를 구별할 수 있어야 한다.
- 때문에 모든 테이블에는 컬럼 한 개 이상으로 구성된 기본키가 있어야 한다.
- 기본키는 로우마다 유일해야 하며 NULL 값을 가질 수 없다.
- 기본키가 없는 테이블 간의 관계를 모델링하는 것은 일반적으로 불가능하다.

### 기본키가 없을 경우 문제
- 테이블에 기본키가 없으면 반복적이고 일관성 없는 데이터가 쌓여 쿼리 수행속도가 느리고, 부정확한 정보를 조회하는 등 모든 종류의 문제를 일으킬 수 있다.

| Customer       |
|----------------|
| John A, Smith  |
| Smith, John A. |
| John Smith     |
| John A Smith   |
| Smith, John    |
- 이와 같은 주문 테이블이 있다고 가정하자.
- 컴퓨터 관점에서 봤을때 모든 값이 유일하지만 이들은 모두 같은 사람일 수도 있다.
- 컴퓨터는 사람보다 훨씬 빠르지만 프로그래밍 없이는 언제 특정 데이터를 동일한 것으로 간주해야 할지 판단하는 작업을 잘 처리하지 못한다.
- 때문에 `Customer` 칼럼을 기본키로 정의할 수 있는데 유일한 값을 가져야 한다는 요구사항을 만족시키더라도 바람직한 선택은 아니다.

### 기본키 후보 자격
- 유일한 값을 가져야 한다.
- NULL 값을 가질 수 없다.
- 안정적인 값이어야 한다.(갱신할 필요가 없다.)
- 가능한 한 간단한 형태여야 한다.(문자나 부동소수점보다는 정수형이 낫고, 여러 컬럼보다는 단일 컬럼이 낫다.)

### 기본키 전략
- 기본키 후보 자격을 달성하는 일반적인 방법은 의미 없는 숫자 데이터로 자동 생성되는 컬럼을 기본키로 만드는 것이다.
- `DB2` , `SQL Server` , `Oracle 12c` 에서는 `IDENTITY`
- `Access` 에서는 `AutoNumber`
- `MySQL` 에서는 `AUTO_INCREMENT`
- `PostgreSQL` 에서는 `serial`
- `Oracle 12c` 이전 버전에서는 동일한 기능을 구현하려면 컬럼 속성이 아닌 독립적인 시퀀스객체를 사용해야 했다.
  - `DB2` , `SQL Server` , `PostgresSQL` 또한 시퀀스 객체를 지원한다.

## 참조 무결성
- 참조 무결성은 관계 데이터베이스 관계 모델에서 2개의 관련 있던 관계 변수(테이블) 간의 일관성(데이터 무결성)을 말한다.
- 참조 무결성을 준수한다는 것은 NULL 이 아닌 외래키가 설정된 자식 테이블의 각 레코드와 일치하는 레코드가 부모 테이블에 존재한다는 것이다.
- 위의 `Customer` 컬럼 예시에서 만약 잘 설계된 ㅔㅌ이블이라면 고객 정보 컬럼에 외래키를 설정해 `Customers` 테이블의 기본키와 연결되어 있을 것이다.
  - `John Smith` 라는 고객이 실제로 여러 명이더라도 `Customers` 테이블의 각 로우는 유일한 키를 가지므로 각 주문에 대응하는 오직 하나의 고객만 쉽게 식별할 수 있다.
- 테이블 간 참조 무결성을 유지하려면 변경된 기본키 값을 이와 관련 있는 테이블과 모든 자식 레코드에 전파해야 한다.
- 이렇게 갱신이 전파되면 관련 테이블에 잠금(Lock) 이 설정되어 높은 동시성을 지원하는 다중 사용자 데이터베이스에서 심각한 문제를 일으킬 수 있다.

### 참조 무결성 예시
- 텍스트 기반 기본키 `CustomerId` 가 `CompanyName` 과 관련하여 작성된다고 가정하자.
- 만약 회사 명이 바뀌게 되어 `CompanyName` 이 변경되는 경우 이와 관련하여 작성된 `CustomerId` 또한 변경되어야 한다.
- 기본키 값이 변경되기 때문에 관련된 테이블에도 변경이 전파되어야 한다.
- 하지만 만약 의미 없는 값을 키로 사용한다면 `CustomerId` 값을 변경하거나 갱신할 필요가 없어진다.
- 테스트 기반 컬럼을 기본키로 사용하는 이유는 중복 값을 막기 위함이 일반적인 의견이다.
  - `CompanyName` 을 기본키로 만든다면 회사명이 중복되어서는 안된다.
  - 하지만 `CompanyName` 을 유일 인덱스로 추가해 이름이 중복되지 않게 하는 것이 더 쉬운 방법이다.
  - 이렇게 하면 무결성을 확보하며 자동 생성된 숫자 값을 기본키로 사용할 수 있다.

## 복합 기본키를 사용하지 않는 것이 좋은 이유
1. 기본키를 정의할 때 대부분의 데이터베이스 시스템은 해당 컬럼에 유일 인덱스를 같이 만든다.
   - 컬럼 두 개 이상에 유일 인덱스를 만들면 데이터베이스 시스템이 할 일만 더 많아진다.
2. 일반적으로 기본키로 조인을 수행하는데, 기본키가 여러 컬럼으로 구성되어 있으면 쿼리가 좀 더 복잡하고 느려진다.

### 복합 기본키가 허용되는 경우
- 특정 상황에서는 여러 컬럼을 기본키로 사용하는 것이 마땅하다.
- 제품과 판매회사를 연결하는 테이블이 있고, 이 테이블은 관련 테이블의 기본키를 가리키는 `ProductId` , `VenderId` 컬럼으로 구성되어있다고 가정하자.
- 이 테이블에는 특정 판매회사가 해당 제품의 주 공급처인지 부 공급처인지 나타내는 컬럼, 판매회사가 부과하는 제품 가격 컬럼 같은 다른 컬럼도 포함되어 있을 수 있다.
- 자동 생성되는 숫자 컬럼을 추가로 만들어서 인위적으로 기본키를 생성할 수 있지만, `ProductId` , `VenderId` 컬럼을 조합해서 기본키로 사용할 수도 있다.
  - 항상 개별 컬럼을 사용해 이 테이블에 연결하므로 추가로 만든 숫자 컬럼을 키로 사용하기보다는 이 두 컬럼으로 구성된 복합 기본키를 정의하는 것이 더 효율적이다.
  - 두 컬럼을 합쳐 유일한 값이 되기를 원할 것이므로 추가 컬럼을 사용하지 않고 이 두 컬럼을 복합 기본키로 정의하면 더 좋다.

## 정리
- 모든 테이블에는 하나 또는 일련의 컬럼으로 구성된 기본키가 있어야 한다.
- 키가 아닌 컬럼에 중복 값이 들어갈까 봐 걱정된다면, 해당 컬럼에 유일 인덱스를 정의해 무결성을 확보할 수 있다.
- 형태가 가능한 간단하고 값을 갱신할 필요가 없는 컬럼을 키로 사용한다.
